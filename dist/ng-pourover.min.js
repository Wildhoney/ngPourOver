/*! ng-pourover by Adam Timberlake <adam.timberlake@gmail.com> created on 2014-05-14 */
!function(a,b,c){"use strict";var d=b.module("ngPourOver",[]),e=a.PourOver;d.service("PourOver",function(){var a=function(a){this._collection=new e.Collection(a)};return a.prototype={DEFAULT_TYPE:"and",_collection:[],_filters:[],_currentIteration:0,_sortBy:null,_sortAscending:!0,_debug:!1,_perPage:1/0,_pageNumber:1,setDebug:function(a){this._debug=a},setPageNumber:function(a){this._currentIteration++,this._pageNumber=a},previousPage:function(){this._currentIteration++,this._pageNumber-=1},nextPage:function(){this._currentIteration++,this._pageNumber+=1},setPerPage:function(a){this._currentIteration++,this._perPage=a},addExactFilter:function(a,b){return this.addFilter("makeExactFilter",a,b),!1},addInclusionFilter:function(a,b){this.addFilter("makeInclusionFilter",a,b)},addFilter:function(a,b,c){var d=e[a](b,c||this._fetchProperties(b));this._collection.addFilters([d])},addSort:function(a,b){var c=e.Sort.extend({attr:a,fn:b});this._collection.addSorts([new c(a)])},sortBy:function(a,b){this._currentIteration++,this._sortAscending="undefined"==typeof b&&this._sortBy===a?!this._sortAscending:b,this._sortBy=a},addItem:function(a){this._collection.addItems([a])},unsort:function(){this._currentIteration++,this._sortBy=null},filterBy:function(a,b,c){if(this._currentIteration++,c=c||this.DEFAULT_TYPE,!_.contains(["and","or","not"],c))throw"ngPourOver: Type '"+c+"' is not of valid filter types: and, or, not.";if("undefined"==typeof this._collection.filters[a])throw"ngPourOver: Filter '"+a+"' hasn't yet been defined.";this._collection.filters[a].query(b),this._filters[a]=c},unfilterBy:function(a){this._currentIteration++,this._collection.filters[a].query([]),delete this._filters[a]},unfilter:function(){this._currentIteration++;for(var a in this._collection.filters)this._collection.filters.hasOwnProperty(a)&&(this._collection.filters[a].query([]),delete this._filters[a])},_fetchProperties:function(a){var b=_.pluck(this._collection.items,a),c=_.every(b,function(a){return _.isArray(a)});return c&&(b=_.flatten(b)),b}},a}),d.filter("poCollection",function(){var a=0,b=[];return function(d){if(d._debug&&c.time("timeMeasure"),"undefined"==typeof d._collection)return d;if(a===d._currentIteration)return d._debug&&c.timeEnd("timeMeasure"),b;a=d._currentIteration;var f=new e.View("defaultView",d._collection,{page_size:d._perPage}),g=f.match_set,h=d._collection.filters;return f.page(d._pageNumber-1),d._sortBy&&f.setSort(d._sortBy),_.forEach(h,function(a,b){if("undefined"!=typeof d._filters[b]){var c=a.current_query,e=d._filters[b];g=g[e](c)}}),f.match_set=g,b=f.getCurrentItems(),d._debug&&c.timeEnd("timeMeasure"),d._sortAscending&&(b=b.reverse()),b}})}(window,window.angular,window.console);