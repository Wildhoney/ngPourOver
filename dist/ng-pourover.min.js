/*! ng-pourover by Adam Timberlake <adam.timberlake@gmail.com> created on 2014-05-12 */
!function(a){"use strict";var b=a.module("ngPourOver",[]);b.service("PourOver",["$window",function(a){var b=a.PourOver,c=function(a){this._collection=new b.Collection(a)};return c.prototype={DEFAULT_TYPE:"and",_collection:[],_filters:[],addExactFilter:function(a,b){this.addFilter("makeExactFilter",a,b)},addInclusionFilter:function(a,b){this.addFilter("makeInclusionFilter",a,b)},addFilter:function(a,c,d){var e=b[a](c,d||this._fetchProperties(c));this._collection.addFilters([e])},addItem:function(a){this._collection.addItems([a])},filterBy:function(a,b,c){if(c=c||this.DEFAULT_TYPE,!_.contains(["and","or","not"],c))throw"ngPourOver: Type '"+c+"' is not of valid filter types: and, or, not.";if("undefined"==typeof this._collection.filters[a])throw"ngPourOver: Filter '"+a+"' hasn't yet been defined.";this._collection.filters[a].query(b),this._filters[a]=c},unfilterBy:function(a){this._collection.filters[a].query([]),delete this._filters[a]},_fetchProperties:function(a){var b=_.pluck(this._collection.items,a),c=_.every(b,function(a){return _.isArray(a)});return c&&(b=_.flatten(b)),b}},c}]),b.filter("poCollection",function(){return function(a){var b=new PourOver.View("defaultView",a._collection),c=b.match_set,d=a._collection.filters;return _.forEach(d,function(b,d){if("undefined"!=typeof a._filters[d]){var e=b.current_query,f=a._filters[d];c=c[f](e)}}),c?a._collection.get(c.cids):a._collection.items}})}(window.angular);