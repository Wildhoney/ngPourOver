/*! ng-pourover by Adam Timberlake <adam.timberlake@gmail.com> created on 2014-08-11 */
!function(a,b,c,d){"use strict";var e=c.module("ngPourOver",[]),f=a.PourOver;e.service("PourOver",function(){var a=function(a){this._collection=new f.Collection(a)};return b.extend(a.prototype,{DEFAULT_TYPE:"and",TIMING_NAME:"timeMeasure",_collection:[],_collectionCache:[],_filters:[],_currentIteration:0,_lastIteration:0,_sortBy:null,_sortAscending:!0,_debug:!1,_perPage:1/0,_pageNumber:1,setDebug:function(a){this._debug=a},setPageNumber:function(a){this._currentIteration++,this._pageNumber=a},previousPage:function(){this._currentIteration++,this._pageNumber-=1},nextPage:function(){this._currentIteration++,this._pageNumber+=1},setPerPage:function(a){this._currentIteration++,this._perPage=a},addExactFilter:function(a,b,c){this.addFilter("makeExactFilter",a,b,c)},addInclusionFilter:function(a,b,c){this.addFilter("makeInclusionFilter",a,b,c)},addFilter:function(a,b,c,d){var e=b;d&&d.attr&&(e=d.attr);var g=f[a](b,c||this._fetchProperties(e),d);this._collection.addFilters([g])},addSort:function(a,b){var c=f.Sort.extend({attr:a,fn:b});this._collection.addSorts([new c(a)])},sortBy:function(a,c){this._currentIteration++,this._sortAscending=b.isUndefined(c)&&this._sortBy===a?!this._sortAscending:!!c,this._sortBy=a},addItem:function(a){this._collection.addItems([a])},unsort:function(){this._currentIteration++,this._sortBy=null},filterBy:function(a,c,d){if(this._currentIteration++,d=d||this.DEFAULT_TYPE,!b.contains(["and","or","not"],d))throw"ngPourOver: Type '"+d+"' is not of valid filter types: and, or, not.";if(b.isUndefined(this._collection.filters[a]))throw"ngPourOver: Filter '"+a+"' hasn't yet been defined.";this._filters[a]={property:d,value:c,type:d}},unfilterBy:function(a){this._currentIteration++,delete this._filters[a]},unfilter:function(){this._currentIteration++;for(var a in this._collection.filters)this._collection.filters.hasOwnProperty(a)&&delete this._filters[a]},_fetchProperties:function(a){var c=b.pluck(this._collection.items,a),d=b.every(c,b.isArray);return d&&(c=b.flatten(c)),c}}),a}),e.filter("poCollection",function(){return function(a){if(a._debug&&d.time(this.TIMING_NAME),b.isUndefined(a._collection))return a;if(a._lastIteration===a._currentIteration)return a._debug&&d.timeEnd(this.TIMING_NAME),a._collectionCache;a._lastIteration=a._currentIteration;var c=new f.View("defaultView",a._collection,{page_size:a._perPage}),e=c.match_set;c.page(a._pageNumber-1),a._sortBy&&c.setSort(a._sortBy);for(var g in a._filters)if(a._filters.hasOwnProperty(g)){var h=a._collection.filters[g],i=a._filters[g];h.query(i.value),e=e[i.type](h.current_query)}return c.match_set=e,a._totalViewItems=e.cids.length,a._collectionCache=c.getCurrentItems(),a._debug&&d.timeEnd(this.TIMING_NAME),a._sortAscending&&(a._collectionCache=a._collectionCache.reverse()),a._collectionCache}})}(window,window._,window.angular,window.console);